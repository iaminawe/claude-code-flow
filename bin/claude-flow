#!/usr/bin/env node

const { spawn } = require('child_process');
const path = require('path');

// Get the directory where this script is located
const scriptDir = path.dirname(__filename);
const projectRoot = path.dirname(scriptDir);

// Check if deno is available
try {
  require('child_process').execSync('deno --version', { stdio: 'ignore' });
} catch {
  console.error('Error: Deno is not installed.');
  console.error('Please install Deno from https://deno.land/');
  process.exit(1);
}

// Run the CLI with Deno
const args = [
  'run',
  '--allow-all',
  '--no-check',
  '--unstable-sloppy-imports',
  path.join(projectRoot, 'src', 'cli', 'main.ts'),
  ...process.argv.slice(2)
];

const deno = spawn('deno', args, {
  stdio: 'inherit',
  env: { ...process.env }
});

deno.on('exit', (code) => {
  process.exit(code);
});

deno.on('error', (err) => {
  console.error('Failed to start Claude-Flow:', err);
  process.exit(1);
});
